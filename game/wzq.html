<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>‰∫îÂ≠êÊ£ã - ‰∫éÊ°êÊ∏∏Êàè</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;600&family=Inter:wght@300;400;600&display=swap');

        :root {
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-bg: rgba(255, 255, 255, 0.65);
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
        }

        body {
            font-family: 'Inter', 'Noto Serif SC', sans-serif;
            background-color: #f5f5f7;
            touch-action: none; /* Á¶ÅÁî®Á≥ªÁªüÈªòËÆ§ÊâãÂäøÈò≤Ê≠¢Âπ≤Êâ∞Ê£ãÁõò */
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Âä®ÊÄÅÊµÅ‰ΩìËÉåÊôØ --- */
        .ambient-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            z-index: -2;
        }
        
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            z-index: -1;
            animation: floatOrb 15s infinite ease-in-out alternate;
            opacity: 0.5;
        }
        .orb-1 { width: 40vw; height: 40vw; background: #e0c3fc; top: -10%; left: -10%; }
        .orb-2 { width: 35vw; height: 35vw; background: #8ec5fc; bottom: -5%; right: -5%; animation-delay: -5s; }

        @keyframes floatOrb {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(5vw, 8vh) scale(1.1); }
        }

        /* --- Ê†∏ÂøÉÂÆπÂô® --- */
        .apple-glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            border-radius: 28px;
        }

        .spring-btn {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.2s;
            cursor: pointer;
            user-select: none;
        }
        .spring-btn:active { transform: scale(0.92); }
        
        .mode-card.selected {
            background: rgba(255, 255, 255, 0.95);
            border: 1.5px solid #000;
        }
        .mode-card.selected .check-icon { opacity: 1; transform: scale(1); }
        .check-icon { opacity: 0; transform: scale(0.5); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }

        .segmented-control {
            background: rgba(118, 118, 128, 0.12);
            border-radius: 999px;
            padding: 4px;
            display: flex;
            position: relative;
        }
        .segment-btn {
            flex: 1; text-align: center; padding: 10px 0; font-size: 13px; font-weight: 500;
            z-index: 2; position: relative;
        }
        .segment-indicator {
            position: absolute; top: 4px; left: 4px; bottom: 4px; width: calc(33.33% - 5.3px);
            background: #fff; border-radius: 999px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); z-index: 1;
        }

        /* --- ‰ºòÂåñÂêéÁöÑËΩΩÂÖ•Âä®Áîª --- */
        @keyframes fadeUpIn {
            0% { opacity: 0; transform: translateY(15px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .stagger-1 { animation: fadeUpIn 0.6s ease-out forwards; opacity: 0; animation-delay: 0.1s; }
        .stagger-2 { animation: fadeUpIn 0.6s ease-out forwards; opacity: 0; animation-delay: 0.2s; }
        .stagger-3 { animation: fadeUpIn 0.6s ease-out forwards; opacity: 0; animation-delay: 0.3s; }
        .stagger-4 { animation: fadeUpIn 0.6s ease-out forwards; opacity: 0; animation-delay: 0.4s; }

        .board-container {
            background-color: #e8c39e;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            max-width: 95vw;
            max-height: 95vw;
            aspect-ratio: 1 / 1;
        }

        /* ÊûÅÈÄüÂºÄÂú∫Âä®Áîª */
        .intro-text h1 {
            background: linear-gradient(to bottom, #111, #555);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fastReveal 1.8s ease-in-out forwards;
        }
        @keyframes fastReveal {
            0% { opacity: 0; letter-spacing: 0.4em; filter: blur(8px); }
            30% { opacity: 1; filter: blur(0px); }
            70% { opacity: 1; letter-spacing: 0.2em; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.05); filter: blur(4px); }
        }
    </style>
</head>
<body>

    <div class="ambient-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <!-- ÊûÅÈÄüÂºÄÂú∫ -->
    <div id="intro-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-white transition-opacity duration-500">
        <div class="text-center">
            <h1 class="text-4xl font-light tracking-[0.3em]">‰∫éÊ°êÊ∏∏Êàè</h1>
        </div>
    </div>

    <!-- ËèúÂçïÂ±Ç -->
    <div id="menu-screen" class="fixed inset-0 z-40 flex items-center justify-center opacity-0 transition-all duration-500 hidden">
        <div class="apple-glass w-full max-w-[360px] mx-4 p-8 flex flex-col gap-8">
            
            <div class="text-center stagger-1">
                <div class="inline-block p-3 rounded-2xl bg-white/40 mb-3 shadow-sm">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4"/></svg>
                </div>
                <h2 class="text-xl font-semibold text-[#1d1d1f]">Gomoku Zen</h2>
                <p class="text-xs text-[#86868b] mt-1 font-light tracking-widest uppercase">ÊûÅÁÆÄÂØπÂºà</p>
            </div>

            <div class="flex flex-col gap-4 stagger-2">
                <p class="text-[10px] font-bold text-[#86868b] uppercase tracking-widest pl-1">Ê∏∏ÊàèÊ®°Âºè</p>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="selectMode('PVE')" id="btn-pve" class="mode-card spring-btn relative h-24 rounded-2xl border border-transparent bg-white/40 p-4 flex flex-col justify-between selected">
                        <div class="absolute top-3 right-3 check-icon text-black">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span class="p-1.5 rounded-lg bg-white/60 w-fit text-gray-700">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/></svg>
                        </span>
                        <span class="text-sm font-medium">‰∫∫Êú∫ÂØπÊàò</span>
                    </button>
                    <button onclick="selectMode('PVP')" id="btn-pvp" class="mode-card spring-btn relative h-24 rounded-2xl border border-transparent bg-white/40 p-4 flex flex-col justify-between">
                        <div class="absolute top-3 right-3 check-icon text-black">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span class="p-1.5 rounded-lg bg-white/60 w-fit text-gray-700">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>
                        </span>
                        <span class="text-sm font-medium">Âèå‰∫∫ÂØπÂºà</span>
                    </button>
                </div>
            </div>

            <div id="difficulty-section" class="flex flex-col gap-3 stagger-3">
                <p class="text-[10px] font-bold text-[#86868b] uppercase tracking-widest pl-1">AI ÈöæÂ∫¶</p>
                <div class="segmented-control">
                    <div id="segment-indicator" class="segment-indicator" style="transform: translateX(100%);"></div>
                    <button onclick="selectDifficulty('EASY')" class="segment-btn spring-btn">ÁÆÄÂçï</button>
                    <button onclick="selectDifficulty('MEDIUM')" class="segment-btn spring-btn">ÊôÆÈÄö</button>
                    <button onclick="selectDifficulty('HARD')" class="segment-btn spring-btn">Âõ∞Èöæ</button>
                </div>
            </div>

            <div class="stagger-4">
                <button onclick="launchGame()" class="spring-btn w-full bg-black text-white font-medium py-4 rounded-full shadow-lg flex items-center justify-center gap-2">
                    <span>ÂºÄÂßãÂØπÂ±Ä</span>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Ê∏∏ÊàèÁïåÈù¢ -->
    <div id="game-screen" class="hidden flex-1 flex flex-col items-center justify-center opacity-0 transition-opacity duration-500">
        <div class="w-full max-w-xl px-6 mb-4 flex justify-between items-center">
            <button onclick="backToMenu()" class="spring-btn w-10 h-10 rounded-full bg-white/80 backdrop-blur-md flex items-center justify-center shadow-sm border border-white/50">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <div class="flex flex-col items-center">
                <div class="flex items-center gap-2">
                    <div id="status-indicator" class="w-2 h-2 rounded-full bg-black"></div>
                    <span id="game-status" class="text-sm font-semibold text-gray-800">ÈªëÊñπ</span>
                </div>
            </div>
            <div class="w-10"></div>
        </div>

        <div class="board-container p-2 md:p-4 rounded-xl relative" id="board-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="w-full max-w-[320px] mt-6 px-4">
            <div class="apple-glass p-1.5 flex gap-1 rounded-full">
                <button onclick="undoMove()" class="spring-btn flex-1 py-3 rounded-full text-xs font-medium text-gray-600 hover:bg-white/50 flex items-center justify-center gap-2">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                    ÊÇîÊ£ã
                </button>
                <button onclick="initGame()" class="spring-btn flex-1 py-3 rounded-full text-xs font-medium text-gray-600 hover:bg-white/50 flex items-center justify-center gap-2">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.5 2v6h-6"/><path d="M21.34 15.57a10 10 0 1 1-.57-8.38"/></svg>
                    ÈáçÁΩÆ
                </button>
            </div>
        </div>
    </div>

    <!-- ÂºπÁ™ó -->
    <div id="modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/20 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-[32px] shadow-2xl p-8 max-w-[280px] w-full text-center transform scale-95 transition-transform duration-300">
            <div id="modal-icon" class="text-4xl mb-3">üèÜ</div>
            <h2 id="modal-title" class="text-lg font-bold mb-1">Ê∏∏ÊàèÁªìÊùü</h2>
            <p id="modal-message" class="text-xs text-gray-500 mb-6 px-2">ÊÅ≠ÂñúËé∑ËÉúÔºÅ</p>
            <button onclick="closeModalAndRestart()" class="spring-btn w-full bg-black text-white font-medium py-3 rounded-2xl mb-2">ÂÜçÊù•‰∏ÄÂ±Ä</button>
            <button onclick="backToMenu()" class="spring-btn w-full text-gray-400 text-xs py-2">ËøîÂõû‰∏ªËèúÂçï</button>
        </div>
    </div>

    <script>
        const GRID_SIZE = 15;
        const EMPTY = 0, BLACK = 1, WHITE = 2;
        let board = [], currentPlayer = BLACK, isGameOver = false, moveHistory = [];
        let canvas, ctx, cellSize, offset, lastMove = null;
        let gameMode = 'PVE', difficulty = 'MEDIUM';

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Âä†ÈÄüÂä†ËΩΩÔºö1.8s ÂêéÊòæÁ§∫ËèúÂçï
            setTimeout(() => {
                const intro = document.getElementById('intro-screen');
                const menu = document.getElementById('menu-screen');
                intro.style.opacity = '0';
                setTimeout(() => {
                    intro.style.display = 'none';
                    menu.classList.remove('hidden');
                    void menu.offsetWidth;
                    menu.style.opacity = '1';
                }, 500);
            }, 1800);

            window.addEventListener('resize', handleResize);
            canvas.addEventListener('mousedown', handleInput);
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault(); // ÈòªÊ≠¢ÊªöÂä®
                handleInput(e);
            }, {passive: false});
        };

        function selectMode(mode) {
            gameMode = mode;
            document.getElementById('btn-pve').classList.toggle('selected', mode === 'PVE');
            document.getElementById('btn-pvp').classList.toggle('selected', mode === 'PVP');
            const diffSec = document.getElementById('difficulty-section');
            diffSec.style.opacity = mode === 'PVE' ? '1' : '0.2';
            diffSec.style.pointerEvents = mode === 'PVE' ? 'auto' : 'none';
        }

        function selectDifficulty(diff) {
            difficulty = diff;
            const pos = diff === 'EASY' ? '0%' : (diff === 'MEDIUM' ? '100%' : '200%');
            document.getElementById('segment-indicator').style.transform = `translateX(${pos})`;
        }

        function launchGame() {
            document.getElementById('menu-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('menu-screen').classList.add('hidden');
                const game = document.getElementById('game-screen');
                game.classList.remove('hidden');
                void game.offsetWidth;
                game.classList.remove('opacity-0');
                initGame();
            }, 500);
        }

        function backToMenu() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('game-screen').classList.add('opacity-0');
            setTimeout(() => {
                document.getElementById('game-screen').classList.add('hidden');
                const menu = document.getElementById('menu-screen');
                menu.classList.remove('hidden');
                void menu.offsetWidth;
                menu.style.opacity = '1';
            }, 500);
        }

        function initGame() {
            board = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(EMPTY));
            currentPlayer = BLACK;
            isGameOver = false;
            moveHistory = [];
            lastMove = null;
            updateStatusUI();
            handleResize();
        }

        function handleResize() {
            const wrapper = document.getElementById('board-wrapper');
            if(!wrapper || wrapper.clientWidth === 0) return;
            const size = Math.min(wrapper.clientWidth, window.innerHeight * 0.6);
            const dpr = window.devicePixelRatio || 1;
            canvas.width = size * dpr;
            canvas.height = size * dpr;
            canvas.style.width = `${size}px`;
            canvas.style.height = `${size}px`;
            ctx.scale(dpr, dpr);
            offset = size * 0.05;
            cellSize = (size - offset * 2) / (GRID_SIZE - 1);
            drawBoard();
        }

        function drawBoard() {
            const size = canvas.width / (window.devicePixelRatio || 1);
            ctx.clearRect(0, 0, size, size);
            ctx.strokeStyle = "rgba(0,0,0,0.15)";
            ctx.lineWidth = 1;
            for(let i=0; i<GRID_SIZE; i++){
                ctx.beginPath();
                ctx.moveTo(offset, offset + i*cellSize); ctx.lineTo(size-offset, offset + i*cellSize);
                ctx.moveTo(offset + i*cellSize, offset); ctx.lineTo(offset + i*cellSize, size-offset);
                ctx.stroke();
            }
            const stars = [3, 7, 11];
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            stars.forEach(r => stars.forEach(c => {
                ctx.beginPath(); ctx.arc(offset+c*cellSize, offset+r*cellSize, 3, 0, Math.PI*2); ctx.fill();
            }));
            for(let y=0; y<GRID_SIZE; y++) for(let x=0; x<GRID_SIZE; x++) if(board[y][x]!==EMPTY) drawStone(x,y,board[y][x]);
            if(lastMove) drawLastMoveMarker(lastMove.x, lastMove.y);
        }

        function drawStone(x,y,type) {
            const cx = offset + x*cellSize, cy = offset + y*cellSize, r = cellSize * 0.4;
            ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2);
            const grad = ctx.createRadialGradient(cx-r*0.3, cy-r*0.3, r*0.1, cx, cy, r);
            if(type === BLACK) { grad.addColorStop(0, "#444"); grad.addColorStop(1, "#000"); }
            else { grad.addColorStop(0, "#fff"); grad.addColorStop(1, "#ddd"); }
            ctx.fillStyle = grad; ctx.fill();
            ctx.strokeStyle = type===BLACK ? "transparent" : "#ccc"; ctx.lineWidth = 0.5; ctx.stroke();
        }

        function drawLastMoveMarker(x,y) {
            ctx.strokeStyle = "red"; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(offset+x*cellSize, offset+y*cellSize, cellSize*0.15, 0, Math.PI*2); ctx.stroke();
        }

        function handleInput(e) {
            if(isGameOver || (gameMode==='PVE' && currentPlayer===WHITE)) return;
            const rect = canvas.getBoundingClientRect();
            const cx = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const cy = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            const scale = canvas.width / (window.devicePixelRatio || 1) / rect.width;
            const gx = Math.round((cx * scale - offset) / cellSize);
            const gy = Math.round((cy * scale - offset) / cellSize);
            if(gx>=0 && gx<GRID_SIZE && gy>=0 && gy<GRID_SIZE && board[gy][gx]===EMPTY) makeMove(gx, gy, currentPlayer);
        }

        function makeMove(x,y,player) {
            board[y][x] = player; lastMove = {x,y}; moveHistory.push({x,y,player});
            drawBoard();
            if(checkWin(x,y,player)) { isGameOver=true; setTimeout(() => showModal(player), 300); return; }
            currentPlayer = player === BLACK ? WHITE : BLACK;
            updateStatusUI();
            if(gameMode==='PVE' && currentPlayer===WHITE) setTimeout(makeAIMove, 500);
        }

        function makeAIMove() {
            if(isGameOver) return;
            let best = -1, moves = [];
            for(let y=0; y<GRID_SIZE; y++) for(let x=0; x<GRID_SIZE; x++) {
                if(board[y][x]===EMPTY) {
                    let score = evaluate(x,y,WHITE) + evaluate(x,y,BLACK) * (difficulty==='HARD'?1.2:0.8);
                    if(score > best) { best = score; moves = [{x,y}]; }
                    else if(score === best) moves.push({x,y});
                }
            }
            const m = moves[Math.floor(Math.random()*moves.length)];
            makeMove(m.x, m.y, WHITE);
        }

        function evaluate(x,y,role) {
            let total = 0;
            const dirs = [[1,0],[0,1],[1,1],[1,-1]];

            for(let [dx,dy] of dirs) {
                let count = 1, blocked = 0;
                for(let s of [1,-1]) {
                    for(let i=1; i<5; i++) {
                        let nx = x+dx*i*s, ny = y+dy*i*s;
                        if(nx<0||nx>=GRID_SIZE||ny<0||ny>=GRID_SIZE) { blocked++; break; }
                        if(board[ny][nx]===role) count++;
                        else if(board[ny][nx]===EMPTY) break;
                        else { blocked++; break; }
                    }
                }
                if(count>=5) total += 10000;
                else if(count===4) total += blocked===0 ? 5000 : (blocked===1?1000:0);
                else if(count===3) total += blocked===0 ? 800 : (blocked===1?200:0);
                else total += count * 10;
            }
            return total;
        }

        function checkWin(x,y,p) {
            const dirs = [[1,0],[0,1],[1,1],[1,-1]];
            for(let [dx,dy] of dirs) {
                let c = 1;
                for(let s of [1,-1]) {
                    for(let i=1; i<5; i++) {
                        let nx=x+dx*i*s, ny=y+dy*i*s;
                        if(nx>=0&&nx<GRID_SIZE&&ny>=0&&ny<GRID_SIZE&&board[ny][nx]===p) c++; else break;
                    }
                }
                if(c>=5) return true;
            }
            return false;
        }

        function undoMove() {
            if(moveHistory.length===0 || isGameOver) return;
            let count = gameMode==='PVE' ? 2 : 1;
            while(count-- > 0 && moveHistory.length > 0) {
                let m = moveHistory.pop(); board[m.y][m.x] = EMPTY;
            }
            lastMove = moveHistory.length > 0 ? moveHistory[moveHistory.length-1] : null;
            currentPlayer = BLACK; drawBoard(); updateStatusUI();
        }

        function updateStatusUI() {
            document.getElementById('game-status').innerText = currentPlayer === BLACK ? "ÈªëÊñπËêΩÂ≠ê" : "ÁôΩÊñπËêΩÂ≠ê";
            document.getElementById('status-indicator').className = `w-2 h-2 rounded-full ${currentPlayer===BLACK?'bg-black':'bg-white border border-gray-300'}`;
        }

        function showModal(p) {
            const m = document.getElementById('modal');
            m.classList.remove('hidden');
            setTimeout(() => m.classList.remove('opacity-0'), 10);
            document.getElementById('modal-message').innerText = p === BLACK ? "ÈªëÊñπËÉúÂá∫ÔºÅÊ£ãÂäõÊ∑±Âéö„ÄÇ" : "ÁôΩÊñπËÉúÂá∫ÔºÅÂÜçÊé•ÂÜçÂéâ„ÄÇ";
            document.getElementById('modal-icon').innerText = p === BLACK ? "‚ö´" : "‚ö™";
        }

        function closeModalAndRestart() {
            document.getElementById('modal').classList.add('opacity-0');
            setTimeout(() => { document.getElementById('modal').classList.add('hidden'); initGame(); }, 300);
        }
    </script>
</body>
</html>