<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>水卡发卡器</title>
<!-- 引入 Tailwind CSS 进行美化 -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- 引入一些基础图标 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    /* 自定义一些微调，增强质感 */
    body {
        background-color: #f3f4f6;
        background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
        background-size: 20px 20px;
    }
    .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
    }
    .btn-transition {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-transition:active {
        transform: scale(0.98);
    }
    
    /* 登录相关的动画类 */
    .shake {
        animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    
    /* 初始锁定状态的主应用样式 */
    #app-content.locked {
        filter: blur(12px) grayscale(0.5);
        transform: scale(0.92);
        opacity: 0.6;
        pointer-events: none;
    }
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 text-gray-800 font-sans antialiased overflow-hidden">

  <!-- 登录遮罩层 -->
  <div id="login-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900/30 backdrop-blur-md transition-all duration-700 ease-in-out">
    <div id="login-box" class="bg-white/90 backdrop-filter backdrop-blur-xl p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-500 scale-100 border border-white/50">
        <div class="text-center mb-6">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 text-blue-600 mb-4 shadow-inner">
                <i class="fa-solid fa-lock text-2xl"></i>
            </div>
            <h2 class="text-xl font-bold text-gray-800">安全访问</h2>
            <p class="text-gray-500 text-xs mt-1">请输入访问密码以继续</p >
        </div>
        
        <div class="space-y-4">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                    <i class="fa-solid fa-key text-sm"></i>
                </div>
                <input type="password" id="password-input" 
                    class="block w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all outline-none bg-gray-50 hover:bg-white text-center tracking-widest"
                    placeholder="•••••••">
            </div>
            
            <button id="unlock-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all duration-200 active:scale-95 flex items-center justify-center gap-2">
                <span>解锁</span>
                <i class="fa-solid fa-arrow-right text-sm"></i>
            </button>
        </div>
        <div id="login-msg" class="text-red-500 text-xs text-center mt-3 h-4 opacity-0 transition-opacity">密码错误</div>
    </div>
  </div>

  <!-- 主应用内容 (包裹在 div 中以便控制模糊动画) -->
  <div id="app-content" class="w-full max-w-lg glass-effect rounded-2xl shadow-xl border border-white/50 overflow-hidden locked transition-all duration-1000 ease-[cubic-bezier(0.22,1,0.36,1)]">
    
    <!-- 头部区域 -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-center text-white relative overflow-hidden">
        <!-- 装饰背景圆圈 -->
        <div class="absolute top-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full -translate-x-10 -translate-y-10"></div>
        <div class="absolute bottom-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full translate-x-10 translate-y-10"></div>
        
        <div class="relative z-10">
            <div class="text-4xl mb-2"><i class="fa-solid fa-nfc-symbol"></i></div>
            <h1 class="text-2xl font-bold tracking-wide">水卡发卡器</h1>
            <p class="text-blue-100 text-xs mt-1 opacity-80">Dump Generator & Editor</p >
        </div>
    </div>

    <div class="p-6 space-y-6">
        
        <!-- 说明区域 -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg text-sm">
            <div class="flex items-start">
                <div class="flex-shrink-0 text-blue-500 mt-0.5">
                    <i class="fa-solid fa-circle-info"></i>
                </div>
                <div class="ml-3 text-blue-700 space-y-1">
                    <p class="font-semibold mb-1">使用说明：</p >
                    <ul class="list-disc list-inside space-y-1 opacity-90 text-xs sm:text-sm">
                        <li>已内置 <code>200.dump</code> 模板 (Base64)。</li>
                        <li>程序将在偏移 <strong>264</strong> 处写入金额。</li>
                        <li>数据处理完全在本地浏览器完成，安全无上传。</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 主操作区域 -->
        <div class="space-y-3">
            <label for="amount" class="block text-sm font-semibold text-gray-700 ml-1">
                充值金额 <span class="text-gray-400 font-normal">(例如 100 或 9.1)</span>
            </label>
            
            <div class="flex flex-col sm:flex-row gap-3">
                <div class="relative flex-grow">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-500 sm:text-sm">¥</span>
                    </div>
                    <input type="text" id="amount" value="100" 
                        class="block w-full pl-7 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors text-lg font-medium placeholder-gray-400 shadow-sm"
                        placeholder="0.00">
                </div>
                
                <button id="genBtn" class="btn-transition bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl shadow-lg shadow-blue-200 flex items-center justify-center gap-2 whitespace-nowrap sm:w-auto w-full">
                    <i class="fa-solid fa-download"></i>
                    <span>生成并下载</span>
                </button>
            </div>
        </div>

        <!-- 分割线 -->
        <div class="border-t border-gray-100"></div>

        <!-- 辅助功能按钮 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <button id="previewBtn" class="btn-transition py-2.5 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium flex items-center justify-center gap-2 border border-transparent hover:border-gray-300">
                <i class="fa-regular fa-eye"></i> 预览当前金额
            </button>
            <button id="showHex" class="btn-transition py-2.5 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium flex items-center justify-center gap-2 border border-transparent hover:border-gray-300">
                <i class="fa-solid fa-code"></i> 查看 HEX 数据
            </button>
        </div>

        <!-- 状态栏 -->
        <div id="status" class="hidden animate-fade-in-up">
            <!-- JS会动态填充这里的内容 -->
        </div>

    </div>
    
    <!-- 底部版权/信息 -->
    <div class="bg-gray-50 px-6 py-3 text-center border-t border-gray-200">
        <p class="text-xs text-gray-400 font-mono">Offset: 264 | Type: Float32 (LE)</p >
    </div>
  </div>

<script>
(function(){
  
  // --- 安全登录逻辑 ---
  const loginOverlay = document.getElementById('login-overlay');
  const loginBox = document.getElementById('login-box');
  const passInput = document.getElementById('password-input');
  const unlockBtn = document.getElementById('unlock-btn');
  const loginMsg = document.getElementById('login-msg');
  const appContent = document.getElementById('app-content');

  // 页面加载后聚焦密码框
  setTimeout(() => passInput.focus(), 100);

  function checkPassword() {
    const val = passInput.value;
    // 使用 Base64 + 简单的盐值 ("Water") 来隐藏真实密码
    // 原始密码: 9178130 -> "9178130" + "Water" -> "9178130Water"
    // btoa("9178130Water") === "OTE3ODEzMFdhdGVy"
    // 这样代码里就不会直接出现 "9178130"
    if (btoa(val + 'Water') === 'OTE3ODEzMFdhdGVy') {
        performUnlock();
    } else {
        performShake();
    }
  }

  function performUnlock() {
    // 1. 隐藏登录框
    loginOverlay.classList.remove('backdrop-blur-md', 'bg-gray-900/30'); // 移除背景模糊和颜色
    loginOverlay.classList.add('pointer-events-none'); // 穿透点击
    
    // 登录框放大并消失
    loginBox.style.transform = 'scale(1.1)';
    loginBox.style.opacity = '0';
    
    // 2. 显示主应用 (移除 locked 类)
    appContent.classList.remove('locked');

    // 3. 清理 DOM (可选，延迟后移除)
    setTimeout(() => {
        loginOverlay.style.display = 'none';
    }, 700);
  }

  function performShake() {
    loginBox.classList.add('shake');
    passInput.classList.add('ring-2', 'ring-red-500', 'bg-red-50');
    loginMsg.style.opacity = '1';
    
    setTimeout(() => {
        loginBox.classList.remove('shake');
        passInput.classList.remove('ring-2', 'ring-red-500', 'bg-red-50');
        passInput.value = '';
        passInput.focus();
    }, 500);
  }

  unlockBtn.addEventListener('click', checkPassword);
  passInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') checkPassword();
  });
  
  // --- 原始业务逻辑 (保持 100% 不变) ---
  const OFFSET = 264;
  // embedded base64 template (your 200.dump)
  const template_b64 = "RpzyZEwIBAABBM+HOtnNHQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////8HgGn///////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////B4Bp////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////wAAAAAAAAAAAABIQwAAAACBPlhIcrGgVNgYKpHYqPyYAAAAAAAAAAAAAAAAAAAAAI7l8tqGm/8PAGmBPlhIcrFTVFUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACO5fLahpv/DwBpgT5YSHKxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////8HgGn///////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////B4Bp////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////8HgGn///////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////B4Bp////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////8HgGn///////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////B4Bp////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////weAaf///////w==";
  
  // decode base64 to Uint8Array
  function b64ToUint8Array(b64){
    const bin = atob(b64);
    const len = bin.length;
    const arr = new Uint8Array(len);
    for(let i=0;i<len;i++) arr[i]=bin.charCodeAt(i);
    return arr;
  }
  const templateBytes = b64ToUint8Array(template_b64);

  const amountInput = document.getElementById('amount');
  const genBtn = document.getElementById('genBtn');
  const previewBtn = document.getElementById('previewBtn');
  const status = document.getElementById('status');
  const showHex = document.getElementById('showHex');

  function showStatus(msg, ok=true){
    status.style.display = 'block';
    if(ok) {
        status.className = "bg-green-50 text-green-700 p-3 rounded-lg text-sm flex items-center gap-2 border border-green-200";
        status.innerHTML = `<i class="fa-solid fa-circle-check"></i> <span>${msg}</span>`;
    } else {
        status.className = "bg-orange-50 text-orange-700 p-3 rounded-lg text-sm flex items-center gap-2 border border-orange-200";
        status.innerHTML = `<i class="fa-solid fa-circle-exclamation"></i> <span>${msg}</span>`;
    }
  }

  function readFloatFromTemplate(){
    if(templateBytes.length < OFFSET+4) throw new Error('模板太短，无法读取');
    const dv = new DataView(templateBytes.buffer, templateBytes.byteOffset, templateBytes.byteLength);
    return dv.getFloat32(OFFSET, true);
  }

  previewBtn.addEventListener('click', ()=>{
    try{
      const v = readFloatFromTemplate();
      alert('内置模板偏移 ' + OFFSET + ' 处的 float32 值：' + v);
      showStatus('预览成功：偏移 ' + OFFSET + ' -> ' + v);
    }catch(e){
      alert('预览失败：' + e.message);
      showStatus('预览失败：' + e.message, false);
    }
  });

  function makeDumpBytes(amount){
    if(templateBytes.length < OFFSET+4) throw new Error('模板太短，无法写入');
    const out = new Uint8Array(templateBytes.length);
    out.set(templateBytes);
    const dv = new DataView(out.buffer);
    dv.setFloat32(OFFSET, amount, true);
    return out;
  }

  function downloadUint8Array(arr, filename){
    const blob = new Blob([arr], {type:'application/octet-stream'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  genBtn.addEventListener('click', ()=>{
    const s = amountInput.value.trim();
    if(!s){ alert('请输入金额'); return; }
    const amt = Number(s);
    if(Number.isNaN(amt)){ alert('无法解析金额，请输入数字，例如 100 或 9.1'); return; }
    try{
      const out = makeDumpBytes(amt);
      const fname = Number.isInteger(amt) ? `${amt}.dump` : `${String(amt).replace('.', '_')}.dump`;
      downloadUint8Array(out, fname);
      showStatus(`已生成并触发下载：${fname}`);
    }catch(e){
      alert('生成失败：' + e.message);
      showStatus('生成失败：' + e.message, false);
    }
  });

  showHex.addEventListener('click', ()=>{
    try{
      const start = 256, len=24;
      if(templateBytes.length < start+len) throw new Error('模板太短，无法显示该范围');
      const slice = templateBytes.slice(start, start+len);
      const hex = Array.from(slice).map(b=>b.toString(16).padStart(2,'0')).join(' ');
      alert('偏移 256-279 十六进制:\n' + hex);
    }catch(e){
      alert('显示失败：' + e.message);
    }
  });

  showStatus('就绪：系统正常，等待输入。');
})();
</script>
</body>
</html>