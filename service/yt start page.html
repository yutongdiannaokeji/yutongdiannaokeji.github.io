<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>于桐网址导航 | Yutong Start Page</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- 配置 Tailwind 主题色 -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"SF Pro Display"', '-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'sans-serif'],
                    },
                    animation: {
                        blob: "blob 10s infinite alternate",
                        'fade-in-down': 'fadeInDown 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in-up': 'fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        wiggle: 'wiggle 0.3s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'pop': 'pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" },
                        },
                        fadeInDown: {
                            "from": { opacity: 0, transform: "translateY(-20px)" },
                            "to": { opacity: 1, transform: "translateY(0)" },
                        },
                        fadeInUp: {
                            "from": { opacity: 0, transform: "translateY(20px)" },
                            "to": { opacity: 1, transform: "translateY(0)" },
                        },
                        wiggle: {
                            "0%, 100%": { transform: "rotate(-1deg)" },
                            "50%": { transform: "rotate(1deg)" }
                        },
                        pop: {
                            "0%": { transform: "scale(0.8)", opacity: 0 },
                            "100%": { transform: "scale(1)", opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* 隐藏滚动条但允许滚动 */
        body::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 玻璃拟态效果辅助 */
        .glass {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 冲击波动画层 */
        .shockwave {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            transform: scale(0);
            opacity: 0.8;
            animation: expand-ripple 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes expand-ripple {
            0% {
                transform: scale(0);
                opacity: 0.8;
            }
            50% {
                opacity: 0.6;
            }
            100% {
                transform: scale(150); /* 放大到覆盖屏幕 */
                opacity: 0;
            }
        }

        /* 解决高度动画截断问题的 Grid 技术 */
        .expand-wrapper {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .expand-wrapper.open {
            grid-template-rows: 1fr;
        }
        .expand-inner {
            overflow: hidden;
            /* 关键：增加 padding 防止阴影被 overflow:hidden 截断 */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
    </style>
</head>
<body class="min-h-screen w-full transition-colors duration-500 ease-in-out font-sans selection:bg-opacity-30 overflow-x-hidden">

    <!-- 动态背景光斑 -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div id="blob-1" class="absolute -top-[20%] -left-[10%] w-[70vw] h-[70vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob transition-colors duration-1000"></div>
        <div id="blob-2" class="absolute top-[20%] -right-[10%] w-[60vw] h-[60vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob animation-delay-2000 transition-colors duration-1000 bg-blue-300 dark:bg-blue-600"></div>
        <div id="blob-3" class="absolute -bottom-[20%] left-[20%] w-[60vw] h-[60vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob animation-delay-4000 transition-colors duration-1000 bg-pink-200 dark:bg-pink-600"></div>
    </div>

    <!-- 冲击波容器 -->
    <div id="shockwave-container" class="fixed inset-0 pointer-events-none z-0 overflow-hidden"></div>

    <!-- 主容器 -->
    <div class="relative z-10 container mx-auto px-4 py-6 md:py-16 max-w-6xl flex flex-col items-center min-h-screen">
        
        <!-- Header -->
        <header class="w-full flex justify-between items-center mb-8 md:mb-12 animate-fade-in-down z-50">
            <!-- Logo -->
            <div class="flex items-center gap-3 group cursor-pointer">
                <div id="logo-bg" class="w-11 h-11 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-500 group-hover:scale-105 group-hover:rotate-6">
                    <i data-lucide="layout-grid" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight title-text transition-colors">于桐导航</h1>
                    <p class="text-xs font-bold tracking-[0.2em] uppercase opacity-50 subtitle-text">Start Page</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-3">
                <button id="theme-toggle" class="p-3 rounded-full transition-all duration-300 hover:rotate-12 bg-white/50 hover:bg-white/80 dark:bg-white/10 dark:hover:bg-white/20 text-gray-700 dark:text-yellow-300 backdrop-blur-md shadow-sm">
                    <i data-lucide="moon" id="theme-icon" class="w-5 h-5"></i>
                </button>
                <button id="edit-toggle" class="px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 bg-white/50 hover:bg-white/80 dark:bg-white/10 dark:hover:bg-white/20 text-gray-900 dark:text-white backdrop-blur-md shadow-sm border border-transparent hover:border-gray-200 dark:hover:border-white/10">
                    <i data-lucide="settings" id="edit-icon" class="w-4 h-4 transition-transform duration-500"></i>
                    <span id="edit-text">自定义</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="w-full flex-1 flex flex-col items-center gap-8 md:gap-10">
            
            <!-- Clock -->
            <div class="text-center space-y-2 animate-fade-in-up select-none">
                <h2 id="clock" class="text-7xl md:text-9xl font-bold tracking-tighter tabular-nums text-transparent bg-clip-text bg-gradient-to-b from-current to-transparent opacity-90 title-text drop-shadow-sm">
                    00:00
                </h2>
                <p id="greeting" class="text-base md:text-xl font-medium subtitle-text opacity-60 tracking-wide">
                    Hello
                </p>
            </div>

            <!-- Search Bar -->
            <div class="w-full max-w-2xl relative group animate-fade-in-up animation-delay-200 z-40">
                <!-- Search Glow -->
                <div id="search-glow" class="absolute -inset-1 rounded-3xl opacity-30 group-hover:opacity-70 blur-xl transition duration-500 bg-gradient-to-r from-gray-400 to-gray-500 scale-95 group-hover:scale-100"></div>
                
                <div class="relative flex items-center">
                    <!-- 搜索引擎切换按钮 -->
                    <div class="absolute left-2.5 flex items-center z-50">
                         <button id="engine-btn" class="p-2.5 rounded-xl hover:bg-gray-100/50 dark:hover:bg-gray-800/50 transition-colors flex items-center gap-1.5 group/engine backdrop-blur-sm">
                             <img id="engine-icon" src="" class="w-6 h-6 object-contain drop-shadow-sm" alt="Engine">
                             <i data-lucide="chevron-down" class="w-3 h-3 opacity-40 transition-transform group-hover/engine:rotate-180"></i>
                         </button>
                         <!-- 引擎选择下拉菜单 -->
                         <div id="engine-menu" class="hidden absolute top-full left-0 mt-3 w-40 glass bg-white/80 dark:bg-gray-900/80 rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/30 overflow-hidden flex-col p-1.5 transform origin-top-left transition-all animate-pop z-50">
                            <!-- JS 生成选项 -->
                         </div>
                    </div>

                    <form id="search-form" class="w-full flex items-center" onsubmit="handleSearch(event)">
                        <input
                            id="search-input"
                            type="text"
                            placeholder="搜索感兴趣的内容..."
                            class="w-full py-5 px-6 pl-[5.5rem] md:pl-24 pr-14 text-lg rounded-3xl outline-none transition-all duration-300 shadow-2xl bg-white/80 dark:bg-gray-900/80 text-gray-900 dark:text-white border border-white/50 dark:border-gray-700/30 focus:bg-white dark:focus:bg-gray-900 placeholder-gray-400/80 backdrop-blur-xl"
                        />
                        <button 
                            type="submit"
                            id="search-submit"
                            class="absolute right-3 p-2.5 rounded-2xl transition-all duration-300 opacity-0 translate-x-4 pointer-events-none text-white shadow-lg hover:scale-105 active:scale-95">
                            <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Color Picker (Animated Expansion) -->
            <div id="color-picker-wrapper" class="w-full max-w-3xl expand-wrapper z-30">
                 <div class="expand-inner flex flex-col items-center">
                    <!-- Glass Container for colors -->
                    <div class="glass px-8 py-6 rounded-3xl flex flex-wrap justify-center gap-6 shadow-2xl bg-white/30 dark:bg-black/20">
                         <div id="color-picker" class="flex flex-wrap justify-center gap-5">
                             <!-- JS Generated Colors -->
                         </div>
                    </div>
                 </div>
            </div>

            <!-- Sites Grid -->
            <div id="sites-grid" class="w-full grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6 animate-fade-in-up animation-delay-200 pb-24 px-2 md:px-0">
                <!-- JS Generated Sites -->
                
                <!-- Add Button -->
                <button onclick="openModal()" class="group flex flex-col items-center justify-center p-4 md:p-6 rounded-3xl border-2 border-dashed transition-all duration-300 border-gray-300 hover:border-gray-400 hover:bg-white/50 dark:border-gray-700 dark:hover:border-gray-500 dark:hover:bg-gray-800/30">
                    <div class="w-12 h-12 md:w-14 md:h-14 mb-3 md:mb-4 rounded-2xl flex items-center justify-center transition-all duration-300 group-hover:scale-110 bg-gray-100 text-gray-400 dark:bg-gray-800/50 dark:text-gray-500 group-hover:text-gray-900 dark:group-hover:text-white">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </div>
                    <span class="font-bold text-xs md:text-sm text-gray-400 group-hover:text-gray-600 dark:text-gray-500 dark:group-hover:text-gray-300">添加</span>
                </button>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="absolute bottom-4 py-4 text-xs font-medium opacity-40 text-gray-500 dark:text-gray-400 hover:opacity-100 transition-opacity">
            Designed for Yutong © <span id="year"></span>
        </footer>

    </div>

    <!-- Modal (Add/Edit) -->
    <div id="modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>
        <div class="relative w-full max-w-md p-8 rounded-[2rem] shadow-2xl transform scale-95 transition-all duration-300 bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800" id="modal-content">
            <div class="flex justify-between items-center mb-8">
                <h3 id="modal-title" class="text-2xl font-bold dark:text-white">添加网站</h3>
                <button onclick="closeModal()" class="p-2.5 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-500 dark:text-gray-400">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            
            <form onsubmit="handleSaveSite(event)" class="space-y-6">
                <input type="hidden" id="site-id">
                <div class="space-y-2">
                    <label class="text-sm font-bold opacity-60 ml-1 dark:text-gray-300 uppercase tracking-wider text-[10px]">Title</label>
                    <div class="flex items-center px-5 py-4 rounded-2xl border-2 transition-all bg-gray-50 border-transparent focus-within:bg-white focus-within:border-gray-200 dark:bg-gray-800/50 dark:focus-within:bg-gray-900 dark:focus-within:border-gray-700">
                        <i data-lucide="type" class="opacity-40 mr-4 w-5 h-5 dark:text-white"></i>
                        <input id="site-title" type="text" required placeholder="网站名称" class="bg-transparent outline-none w-full font-bold text-lg dark:text-white placeholder-gray-400" autocomplete="off">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-bold opacity-60 ml-1 dark:text-gray-300 uppercase tracking-wider text-[10px]">URL</label>
                    <div class="flex items-center px-5 py-4 rounded-2xl border-2 transition-all bg-gray-50 border-transparent focus-within:bg-white focus-within:border-gray-200 dark:bg-gray-800/50 dark:focus-within:bg-gray-900 dark:focus-within:border-gray-700">
                        <i data-lucide="link" class="opacity-40 mr-4 w-5 h-5 dark:text-white"></i>
                        <input id="site-url" type="text" required placeholder="yutong.com" class="bg-transparent outline-none w-full font-bold text-lg dark:text-white placeholder-gray-400" autocomplete="off">
                    </div>
                </div>

                <button type="submit" id="modal-submit-btn" class="w-full py-5 rounded-2xl font-bold text-white text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 mt-4">
                    保存
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Configuration & Data ---
        const DEFAULT_SITES = [
            { id: '1', title: 'Bilibili', url: 'https://www.bilibili.com', color: 'from-pink-500 to-rose-500' },
            { id: '2', title: 'GitHub', url: 'https://github.com', color: 'from-gray-700 to-gray-900' },
            { id: '3', title: '知乎', url: 'https://www.zhihu.com', color: 'from-blue-400 to-blue-600' },
            { id: '4', title: 'YouTube', url: 'https://www.youtube.com', color: 'from-red-500 to-red-700' },
            { id: '5', title: 'ChatGPT', url: 'https://chat.openai.com', color: 'from-emerald-400 to-teal-600' },
            { id: '6', title: 'Designer', url: 'https://dribbble.com', color: 'from-pink-400 to-purple-500' },
        ];

        // 增加了颜色的 hex 值用于 JS 动画
        const ACCENT_COLORS = [
            { name: '电光紫', value: 'purple', hex: '#9333ea', class: 'bg-purple-600', from: 'from-purple-500', to: 'to-indigo-600', ring: 'ring-purple-500', shadow: 'shadow-purple-500/40' },
            { name: '天空蓝', value: 'blue', hex: '#2563eb', class: 'bg-blue-600', from: 'from-blue-400', to: 'to-blue-600', ring: 'ring-blue-500', shadow: 'shadow-blue-500/40' },
            { name: '青柠绿', value: 'lime', hex: '#84cc16', class: 'bg-lime-500', from: 'from-lime-400', to: 'to-green-500', ring: 'ring-lime-500', shadow: 'shadow-lime-500/40' },
            { name: '日落橙', value: 'orange', hex: '#f97316', class: 'bg-orange-500', from: 'from-orange-400', to: 'to-red-500', ring: 'ring-orange-500', shadow: 'shadow-orange-500/40' },
            { name: '少女粉', value: 'pink', hex: '#ec4899', class: 'bg-pink-500', from: 'from-pink-400', to: 'to-rose-500', ring: 'ring-pink-500', shadow: 'shadow-pink-500/40' },
            { name: '黑武士', value: 'black', hex: '#111827', class: 'bg-gray-900', from: 'from-gray-700', to: 'to-black', ring: 'ring-gray-500', shadow: 'shadow-gray-900/40' },
        ];

        const ENGINES = [
            { id: 'baidu', name: '百度', url: 'https://www.baidu.com/s?wd=', icon: 'https://www.baidu.com/favicon.ico' },
            { id: 'google', name: 'Google', url: 'https://www.google.com/search?q=', icon: 'https://www.google.com/favicon.ico' },
            { id: 'bing', name: 'Bing', url: 'https://www.bing.com/search?q=', icon: 'https://www.bing.com/favicon.ico' },
         
        ];

        // --- State Management ---
        let state = {
            sites: JSON.parse(localStorage.getItem('yt-sites')) || DEFAULT_SITES,
            darkMode: JSON.parse(localStorage.getItem('yt-darkmode')) !== false,
            accent: JSON.parse(localStorage.getItem('yt-accent')) || ACCENT_COLORS[0],
            engine: JSON.parse(localStorage.getItem('yt-engine')) || ENGINES[0],
            isEditMode: false
        };

        // --- Init ---
        document.getElementById('year').textContent = new Date().getFullYear();
        lucide.createIcons();
        init();
        setInterval(updateClock, 1000);

        function init() {
            renderTheme();
            renderSites();
            renderEngines();
            updateClock();
            
            const input = document.getElementById('search-input');
            const submit = document.getElementById('search-submit');
            input.addEventListener('input', (e) => {
                if(e.target.value.trim()) {
                    submit.classList.remove('opacity-0', 'translate-x-4', 'pointer-events-none');
                } else {
                    submit.classList.add('opacity-0', 'translate-x-4', 'pointer-events-none');
                }
            });

            const engineBtn = document.getElementById('engine-btn');
            const engineMenu = document.getElementById('engine-menu');
            engineBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                engineMenu.classList.toggle('hidden');
                engineMenu.classList.toggle('flex');
            });
            document.addEventListener('click', () => {
                engineMenu.classList.add('hidden');
                engineMenu.classList.remove('flex');
            });
        }

        // --- Rendering ---
        function renderTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const blob1 = document.getElementById('blob-1');
            
            if (state.darkMode) {
                body.classList.add('bg-gray-950', 'text-white', 'dark');
                body.classList.remove('bg-gray-50', 'text-gray-900');
                themeIcon.setAttribute('data-lucide', 'sun');
            } else {
                body.classList.remove('bg-gray-950', 'text-white', 'dark');
                body.classList.add('bg-gray-50', 'text-gray-900');
                themeIcon.setAttribute('data-lucide', 'moon');
            }
            localStorage.setItem('yt-darkmode', state.darkMode);

            const logoBg = document.getElementById('logo-bg');
            const submitBtn = document.getElementById('search-submit');
            const modalBtn = document.getElementById('modal-submit-btn');
            const searchGlow = document.getElementById('search-glow');
            
            logoBg.className = `w-11 h-11 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-500 group-hover:scale-105 group-hover:rotate-6 bg-gradient-to-br ${state.accent.from} ${state.accent.to} ${state.accent.shadow}`;
            submitBtn.className = `absolute right-3 p-2.5 rounded-2xl transition-all duration-300 opacity-0 translate-x-4 pointer-events-none text-white shadow-lg hover:scale-105 active:scale-95 ${state.accent.class}`;
            modalBtn.className = `w-full py-5 rounded-2xl font-bold text-white text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 active:scale-[0.98] transition-all duration-300 mt-4 ${state.accent.class} ${state.accent.shadow}`;
            
            blob1.className = `absolute -top-[20%] -left-[10%] w-[70vw] h-[70vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob transition-colors duration-1000 ${state.darkMode ? state.accent.class : 'bg-purple-300'}`;
            searchGlow.className = `absolute -inset-1 rounded-3xl opacity-30 group-hover:opacity-70 blur-xl transition duration-500 scale-95 group-hover:scale-100 bg-gradient-to-r ${state.accent.from} ${state.accent.to}`;

            // Render Beautiful Color Buttons
            const picker = document.getElementById('color-picker');
            picker.innerHTML = ACCENT_COLORS.map(c => `
                <button onclick="triggerShockwaveAndSetColor(event, '${c.value}')" 
                    class="group relative w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 active:scale-95 ${c.class} shadow-lg ${state.accent.value === c.value ? 'ring-4 ring-offset-2 ring-offset-white dark:ring-offset-gray-900 ' + c.ring : 'hover:shadow-xl'}"
                    title="${c.name}">
                    ${state.accent.value === c.value ? '<i data-lucide="check" class="text-white w-6 h-6 animate-pop"></i>' : ''}
                    <div class="absolute inset-0 rounded-full bg-white opacity-0 group-hover:opacity-20 transition-opacity"></div>
                </button>
            `).join('');

            localStorage.setItem('yt-accent', JSON.stringify(state.accent));
            lucide.createIcons();
        }

        // --- 震撼动画核心逻辑 ---
        function triggerShockwaveAndSetColor(e, val) {
            // 1. 获取点击位置
            const rect = e.target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            
            // 2. 找到目标颜色
            const targetColor = ACCENT_COLORS.find(c => c.value === val);
            if (!targetColor) return;

            // 3. 创建冲击波元素
            const wave = document.createElement('div');
            wave.className = 'shockwave';
            wave.style.left = `${x}px`;
            wave.style.top = `${y}px`;
            wave.style.width = '10px';
            wave.style.height = '10px';
            wave.style.backgroundColor = targetColor.hex; // 使用 Hex 颜色
            wave.style.transform = 'translate(-50%, -50%) scale(0)';
            
            document.getElementById('shockwave-container').appendChild(wave);

            // 4. 延迟一点点切换主题，让冲击波先出来
            setTimeout(() => {
                setAccent(val);
            }, 150);

            // 5. 动画结束后清理 DOM
            setTimeout(() => {
                wave.remove();
            }, 1000);
        }

        function renderSites() {
            const grid = document.getElementById('sites-grid');
            const addButton = grid.lastElementChild;
            grid.innerHTML = '';
            
            state.sites.forEach(site => {
                const el = document.createElement('a');
                el.href = state.isEditMode ? 'javascript:void(0)' : site.url;
                if (!state.isEditMode) el.target = '_blank';
                
                // 更加精致的卡片样式
                el.className = `group relative flex flex-col items-center justify-center p-4 md:p-6 rounded-3xl transition-all duration-300 backdrop-blur-sm
                    ${state.darkMode 
                        ? 'bg-gray-800/40 hover:bg-gray-800/60 border border-white/5 hover:border-white/20' 
                        : 'bg-white/40 hover:bg-white/80 border border-white/40 hover:border-white shadow-sm hover:shadow-xl hover:shadow-gray-200/50'
                    }
                    ${state.isEditMode ? 'animate-wiggle cursor-grab active:cursor-grabbing hover:scale-100' : 'hover:-translate-y-2'}
                `;

                const controls = state.isEditMode ? `
                    <div class="absolute -top-3 -right-3 flex gap-2 z-20 scale-90">
                        <button onclick="openModal('${site.id}', event)" class="p-2 bg-white/10 backdrop-blur-md border border-white/20 text-blue-500 rounded-full shadow-lg hover:bg-blue-500 hover:text-white transition-all">
                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                        </button>
                        <button onclick="deleteSite('${site.id}', event)" class="p-2 bg-white/10 backdrop-blur-md border border-white/20 text-red-500 rounded-full shadow-lg hover:bg-red-500 hover:text-white transition-all">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                ` : '';

                const faviconUrl = `https://www.google.com/s2/favicons?domain=${new URL(site.url).hostname}&sz=128`;
                const colorClass = site.color || `${state.accent.from} ${state.accent.to}`;

                el.innerHTML = `
                    ${controls}
                    <div class="w-14 h-14 mb-4 rounded-2xl flex items-center justify-center text-xl font-bold text-white shadow-lg transition-transform duration-500 group-hover:scale-110 group-hover:rotate-3 bg-gradient-to-br ${colorClass} shadow-lg">
                        <img src="${faviconUrl}" class="w-8 h-8 object-cover rounded-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                        <span class="hidden">${site.title[0].toUpperCase()}</span>
                    </div>
                    <span class="font-bold tracking-wide text-sm truncate w-full text-center transition-colors ${state.darkMode ? 'text-gray-300 group-hover:text-white' : 'text-gray-600 group-hover:text-gray-900'}">
                        ${site.title}
                    </span>
                    <div class="absolute bottom-0 h-1 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 w-0 group-hover:w-1/3 ${state.accent.class} mb-3"></div>
                `;
                
                grid.appendChild(el);
            });
            
            grid.appendChild(addButton);
            lucide.createIcons();
            localStorage.setItem('yt-sites', JSON.stringify(state.sites));
        }

        function renderEngines() {
            const iconImg = document.getElementById('engine-icon');
            const menu = document.getElementById('engine-menu');
            
            iconImg.src = state.engine.icon;
            
            menu.innerHTML = ENGINES.map(eng => `
                <button onclick="setEngine('${eng.id}')" class="w-full flex items-center gap-3 px-3 py-2.5 text-sm text-left hover:bg-black/5 dark:hover:bg-white/10 dark:text-gray-200 rounded-xl transition-colors group">
                    <img src="${eng.icon}" class="w-4 h-4 rounded-sm transition-transform group-hover:scale-110">
                    <span class="${state.engine.id === eng.id ? 'font-bold ' + state.accent.text : ''}">${eng.name}</span>
                </button>
            `).join('');
            
            document.getElementById('search-input').placeholder = `在 ${state.engine.name} 上搜索...`;
            localStorage.setItem('yt-engine', JSON.stringify(state.engine));
        }

        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('clock').textContent = timeStr;
            
            let greet = '';
            if (hours < 12) greet = '早安，开启充满活力的一天';
            else if (hours < 18) greet = '下午好，保持专注';
            else greet = '晚上好，享受属于你的时间';
            
            document.getElementById('greeting').textContent = greet;
        }

        // --- Actions ---
        document.getElementById('theme-toggle').onclick = () => {
            state.darkMode = !state.darkMode;
            renderTheme();
            renderSites();
        };

        document.getElementById('edit-toggle').onclick = () => {
            state.isEditMode = !state.isEditMode;
            
            const btn = document.getElementById('edit-toggle');
            const icon = document.getElementById('edit-icon');
            const text = document.getElementById('edit-text');
            const wrapper = document.getElementById('color-picker-wrapper');
            
            if (state.isEditMode) {
                btn.className = `px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 text-white shadow-lg ${state.accent.class} ${state.accent.shadow}`;
                icon.setAttribute('data-lucide', 'check');
                icon.classList.add('scale-110');
                text.textContent = '完成';
                wrapper.classList.add('open'); // 使用 CSS Grid 动画展开
            } else {
                btn.className = `px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 bg-white/50 hover:bg-white/80 dark:bg-white/10 dark:hover:bg-white/20 text-gray-900 dark:text-white backdrop-blur-md shadow-sm border border-transparent hover:border-gray-200 dark:hover:border-white/10`;
                icon.setAttribute('data-lucide', 'settings');
                icon.classList.remove('scale-110');
                text.textContent = '自定义';
                wrapper.classList.remove('open');
            }
            
            lucide.createIcons();
            renderSites();
        };

        function setAccent(val) {
            state.accent = ACCENT_COLORS.find(c => c.value === val);
            renderTheme();
            renderSites();
            if(state.isEditMode) {
                 const btn = document.getElementById('edit-toggle');
                 btn.className = `px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 flex items-center gap-2 text-white shadow-lg ${state.accent.class} ${state.accent.shadow}`;
            }
        }
        
        function setEngine(id) {
            state.engine = ENGINES.find(e => e.id === id);
            renderEngines();
        }

        function handleSearch(e) {
            e.preventDefault();
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                window.location.href = state.engine.url + encodeURIComponent(query);
            }
        }

        // --- Modal & CRUD ---
        let editingSiteId = null;

        function openModal(siteId = null, event) {
            if(event) event.stopPropagation();
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            
            editingSiteId = siteId;
            const titleInput = document.getElementById('site-title');
            const urlInput = document.getElementById('site-url');
            const modalTitle = document.getElementById('modal-title');
            const btn = document.getElementById('modal-submit-btn');

            if (siteId) {
                const site = state.sites.find(s => s.id === siteId);
                titleInput.value = site.title;
                urlInput.value = site.url.replace(/^https?:\/\//, '');
                modalTitle.textContent = '编辑网站';
                btn.textContent = '保存修改';
            } else {
                titleInput.value = '';
                urlInput.value = '';
                modalTitle.textContent = '添加网站';
                btn.textContent = '立即添加';
            }

            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
            
            titleInput.focus();
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            
            modal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
            editingSiteId = null;
        }

        function handleSaveSite(e) {
            e.preventDefault();
            const title = document.getElementById('site-title').value;
            let url = document.getElementById('site-url').value;
            
            if (!url.startsWith('http')) url = 'https://' + url;

            if (editingSiteId) {
                state.sites = state.sites.map(s => s.id === editingSiteId ? {...s, title, url} : s);
            } else {
                state.sites.push({
                    id: Date.now().toString(),
                    title: title || 'Website',
                    url: url,
                    color: `${state.accent.from} ${state.accent.to}`
                });
            }
            
            renderSites();
            closeModal();
        }

        function deleteSite(id, event) {
            if(event) event.stopPropagation();
            if(confirm('确定要删除这个网站吗？')) {
                state.sites = state.sites.filter(s => s.id !== id);
                renderSites();
            }
        }

        // --- Global Exports ---
        window.handleSearch = handleSearch;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.handleSaveSite = handleSaveSite;
        window.deleteSite = deleteSite;
        window.setEngine = setEngine;
        window.triggerShockwaveAndSetColor = triggerShockwaveAndSetColor; // Exported for HTML onclick
        window.setAccent = setAccent; // Still needed for internal logic

    </script>
</body>
</html>
